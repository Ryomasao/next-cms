---
title: 文字コードメモ
time: 2022-01-05 00:00
tag: ['文字コード']
---


# 符号化文字集合

文字に特定の番号を割り当てたマップ。
世界中の文字を扱ってるUnicodeや日本語にフォーカスしてるJISX0208とかがある。

http://www.unicode.org/charts/nameslist/c_3040.html

例えば、`豆`という文字は、Unicodeだと以下のようにマッピングされている。  

U+8c46

この`U+8c46`はコードポイントと呼ばれるもので、文字のByte列ではないので注意。  

一方、JISX0208だと`豆`は以下の値になる。

3806  

JISX0208では上記のコードを区点コードといい、Unicodeと同じく文字のByte列ではない。

# 符号化文字方式

上記のコードポイント/区点コードを実際のByte列にマッピングする方式を符号化文字方式っていう。  
これがUTF-8だったりShift_JISみたいなもの。

符号化文字集合に対応している符号化方式は決まっていて、JISX0208の場合、Shift_JIS/EUC-JP、UnicodeであればUTF-8/UTF-18と決まってる。


## Q

- 符号化文字集合ってどのレイヤーの話なんだろう。OSがUnicodeに対応してないともちろん表示できないって思ってていいのかな。
- [こちら](https://jsprimer.net/basic/string-unicode/)をみると、jsはUnicode/符号化方式はUTF-16を採用って書いてある。


# 実例集

## ユーザーがブラウザで入力した値を保存して、csvに出力したものを、レガシーシステムで利用したい

ユーザーがブラウザで入力した値を保存して、csvに出力する。出力したcsvをShift_JISでしか扱えないレガシーシステムで利用したいケース。

まずユーザーが、絵文字やタイ語など特殊な文字を入力したら、csvはどうなってしまうのだろう。  

> NOTE ユーザーがブラウザに絵文字やタイ語を入力できるのは、OS && ブラウザがUnicodeベースだからと思ってていいのかな。

これに関してはcsvを扱うアプリケーションの符号化方式がUTF8とかであれば、まったく問題ない。
一方、よくある？csvをwindowsのexcelでそのまま利用したいケース。  

excelでファイルを開いたとき、対象のファイルの文字符号化方式はShift_JISとして開かれてしまうみたい。  
そうするとここで文字化けが発生する。  
文字化けを解消するためにUTF-8からShift_JISに変換をかければいいんだけど、このとき絵文字やタイ語が問題になってくる。  

Shift_JISの文字集合はJISX0208で、そこには日本語以外の文字種が存在していない。
全世界の文字が含まれるUnicodeの絵文字などは日本語のみのJISX0208へ変換しようとした際に、対応する文字種がないので絵文字やタイ語は文字化けしてしまう。  

根本対応ではないけれど、Shift_JISでcsvを利用したい && 文字化けは絶対許さないのであればユーザーがブラウザで入力する際にShift_JISに変換できない文字を弾く必要がありそう。  
実装方法は扱える文字種を定義したテーブルを用意するのが一般的なのかな。

> 尚、excelの機能として、UTF-8でimportする的な機能もあるっぽい。この場合は絵文字もタイ語も問題なくExcel上で表示できると思うんだ。

# 参考にさせていただいた記事

[符号化文字集合と符号化方式の関係](https://qiita.com/yuji38kwmt/items/b3a7820b4d3b544da4ff#%E7%AC%A6%E5%8F%B7%E5%8C%96%E6%96%87%E5%AD%97%E9%9B%86%E5%90%88%E3%81%A8%E7%AC%A6%E5%8F%B7%E5%8C%96%E6%96%B9%E5%BC%8F%E3%81%AE%E9%96%A2%E4%BF%82)





